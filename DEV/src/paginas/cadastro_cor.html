<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="../assets/iconeWeb.ico">
  <title>Preciosos Laços | Cadastro de Cores</title>

  <link rel="stylesheet" href="../styles/cadastro_cor.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&display=swap" rel="stylesheet">

</head>

<body>
  <button class="toggle-btn" id="toggleSidebar"><i class="bi bi-list"></i></button>

  <div class="sidebar" id="sidebar">
    <img src="../assets/logo_preciosos_lacos.png" alt="Logo">
    <ul>
      <li><a href="#"><i class="bi bi-box"></i> <span>Pedidos</span></a></li>
      <li><a href="./dashboard.html"><i class="bi bi-bar-chart"></i> <span>Dashboard</span></a></li>
      <li><a href="./cadastro_modelo.html"><i class="bi bi-tag"></i> <span>Modelos</span></a></li>
      <li><a href="./cadastro_cor.html"><i class="bi bi-palette"></i> <span>Cores</span></a></li>
      <li><a href="#"><i class="bi bi-archive"></i> <span>Coleções</span></a></li>
      <li><a href="./cadastro_tipo_laco.html"><i class="bi bi-scissors"></i> <span>Tipos de Laço</span></a></li>
    </ul>
    <ul>
      <li><a href="./catalogo.html"><i class="bi bi-box-arrow-right"></i> <span>Sair</span></a></li>
    </ul>
  </div>

  <header>Cores</header>

  <div class="nav-pesquisa">
    <div class="nav-search-wrapper">
      <input type="text" class="nav-search-box" placeholder="Pesquisar Cor" aria-label="Pesquisar Cor">
      <i class="bi bi-search" id="lupa-search"></i>
    </div>
    <a class="btn-cadastrar" onclick="document.getElementById('cadastrar').style.display='flex'"><i
        class="bi bi-patch-plus"></i><span> Cadastrar Cores</span></a>
  </div>


  <div class="content">


    <div class="card-container">
      <!-- <div class="card-custom">
        <h5>Vermelho</h5>
        <div class="color-box" style="background:#f44336"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Rosa</h5>
        <div class="color-box" style="background:#f8b2cc"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Lilas</h5>
        <div class="color-box" style="background: #dda0dd"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Azul claro</h5>
        <div class="color-box" style="background: lightskyblue"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Lavanda</h5>
        <div class="color-box" style="background: #cac1fe;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Amarelo</h5>
        <div class="color-box" style="background: #fdfd96;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Verde</h5>
        <div class="color-box" style="background: #98fb98;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Marrom</h5>
        <div class="color-box" style="background: #d2b48c;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Preto</h5>
        <div class="color-box" style="background: #000000;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Branco</h5>
        <div class="color-box" style="background: #ffffff;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div> -->
    </div>

  </div>
  </div>

  <div id="cadastrar" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fechar()">&times;</span>
      <h2 class="tituloPopUp">Cadastro de Cor</h2>

      <input type="text" id="nomeCor" placeholder="Nome da cor: Verde-Água"
        style="width: 100%; padding: 8px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc;">

      <h3 class="titulo">Clique para escolher a cor:</h3>
      <input type="color" id="colorPicker" value="#F29DC3">
      <div class="color-block" id="colorBlock"></div>

      <input type="text" id="valorCor" placeholder="Valor: R$ 0,00"
        style="width: 100%; padding: 8px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc;">

      <h3 class="titulo">
        Associar modelo:
        <i class="bi bi-bookmark-plus-fill" style="color: #000000; margin-left: 5px;"></i>
      </h3>

      <div class="modal-search-wrapper">
        <input type="text" class="searchInput" id="searchModelo" class="search-box" placeholder="Pesquisar modelo">
        <i class="bi bi-search"></i>
      </div>

      <div class="checkboxList">
        <div><input type="checkbox" id="modelo1" value="1"><label for="modelo1">Laço Padrão</label></div>
        <div><input type="checkbox" id="modelo2" value="2"><label for="modelo2">Laço de Piscina</label></div>
        <div><input type="checkbox" id="modelo3" value="3"><label for="modelo3">Laço de Festa</label></div>
        <div><input type="checkbox" id="modelo4" value="4"><label for="modelo4">Laço Infantil</label></div>
        <div><input type="checkbox" id="modelo5" value="5"><label for="modelo5">Laço Escolar</label></div>
        <div><input type="checkbox" id="modelo6" value="6"><label for="modelo6">Laço de Gala</label></div>
        <div><input type="checkbox" id="modelo7" value="7"><label for="modelo7">Laço Esportivo</label></div>
        <div><input type="checkbox" id="modelo8" value="8"><label for="modelo8">Laço Casual</label></div>
      </div>

      <button id="fecharModal" onclick="cadastrarCor()">Cadastrar cor</button>
    </div>
  </div>

  <div id="editar" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fechar()">&times;</span>
      <h2 class="tituloPopUp">Editar Cor</h2>

      <input type="text" style="width: 100%; padding: 8px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc;"
        readonly>

      <h3 class="titulo">Valor</h3>
      <input type="number" id="valorLaco"
        style="width: 100%; padding: 8px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc;">

      <h3 class="titulo">
        Modelos Associados:
        <i class="bi bi-bookmark-plus-fill" style="color: #000000; margin-left: 5px;"></i>
      </h3>

      <div class="modal-search-wrapper">
        <input type="text" class="searchInput" id="searchModeloEditar" class="modal-search-box"
          placeholder="Pesquisar modelo">
        <i class="bi bi-search"></i>
      </div>

      <div class="checkboxList">
        <div><input type="checkbox" id="modelo1"><label for="modelo1">Laço Padrão</label></div>
        <div><input type="checkbox" id="modelo2"><label for="modelo2">Laço de Piscina</label></div>
        <div><input type="checkbox" id="modelo3"><label for="modelo3">Laço de Festa</label></div>
        <div><input type="checkbox" id="modelo4"><label for="modelo4">Laço Infantil</label></div>
        <div><input type="checkbox" id="modelo5"><label for="modelo5">Laço Escolar</label></div>
        <div><input type="checkbox" id="modelo6"><label for="modelo6">Laço de Gala</label></div>
        <div><input type="checkbox" id="modelo7"><label for="modelo7">Laço Esportivo</label></div>
        <div><input type="checkbox" id="modelo8"><label for="modelo8">Laço Casual</label></div>
      </div>

      <button id="fecharModal" onclick="AtualizarCor()">Atualizar cor</button>
    </div>
  </div>

  <div id="excluir" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fechar()">&times;</span>
      <h2 class="tituloPopUp">Você Deseja Deletar: “Vermelho”?</h2>

      <button id="fecharModalExcluir" onclick="ExcluirCor()">Deletar cor</button>
      <button id="fecharModalCancelar" onclick="fechar()">Cancelar</button>
    </div>
  </div>


  <div id="customAlert" class="custom-alert">
    <div class="alert-box">
      <h3 id="alertTitle">Alerta</h3>
      <p id="alertMessage">Mensagem aqui</p>
      <button onclick="fecharAlerta()">OK</button>
    </div>
  </div>


  <script>
    const API_URL = "http://localhost:3000/cores";

    const toggleBtn = document.getElementById("toggleSidebar");
    const sidebar = document.getElementById("sidebar");

    toggleBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      sidebar.classList.toggle("active");
    });

    const items = sidebar.querySelectorAll("li");
    items.forEach(item => {
      item.addEventListener("click", () => {
        if (window.innerWidth <= 992) {
          sidebar.classList.remove("active");
        }
      });
    });

    document.addEventListener("click", (e) => {
      if (window.innerWidth <= 992) {
        if (sidebar.classList.contains("active") && !sidebar.contains(e.target) && e.target !== toggleBtn) {
          sidebar.classList.remove("active");
        }
      }
    });

    function showAlert(tipo, mensagem) {
      let bgColor = "#f0f0f0";
      if (tipo === "sucesso") bgColor = "#28a745";
      else if (tipo === "erro") bgColor = "#dc3545";
      else if (tipo === "aviso") bgColor = "#ffc107";

      const alertDiv = document.createElement("div");
      alertDiv.style.position = "fixed";
      alertDiv.style.top = "20px";
      alertDiv.style.right = "20px";
      alertDiv.style.padding = "15px 20px";
      alertDiv.style.color = "#fff";
      alertDiv.style.backgroundColor = bgColor;
      alertDiv.style.borderRadius = "8px";
      alertDiv.style.boxShadow = "0 2px 8px rgba(0,0,0,0.2)";
      alertDiv.style.zIndex = "9999";
      alertDiv.textContent = mensagem;

      document.body.appendChild(alertDiv);
      setTimeout(() => alertDiv.remove(), 3000);
    }

    async function listarCores() {
      try {
        const res = await fetch(API_URL);
        const cores = await res.json();

        const container = document.querySelector(".card-container");
        container.innerHTML = "";

        cores.forEach(cor => {
          const modelos = Array.isArray(cor.modelos) ? cor.modelos : [];
          const valor = cor.valor ? Number(cor.valor).toFixed(2) : "0.00";
          const card = document.createElement("div");
          card.classList.add("card-custom");
          card.innerHTML = `
        <h5>${cor.nome}</h5>
        <div class="color-box" style="background:${cor.cor}"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>${modelos.map(m => `<li>${m}</li>`).join("")}</ul>
        </div>
        <p class="mt-2">Valor: R$ ${valor}</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="abrirEditar(${cor.id})"></i>
          <i class="bi bi-trash" onclick="abrirExcluir(${cor.id}, '${cor.nome}')"></i>
        </div>
      `;
          container.appendChild(card);
        });
      } catch {
        showAlert("erro", "Erro ao carregar as cores!");
      }
    }

    async function cadastrarCor() {
      const nome = document.getElementById("nomeCor").value.trim();
      const corHex = document.getElementById("colorPicker").value;
      const valor = document.getElementById("valorCor").value.replace("R$ ", "").replace(",", ".").trim();
      const modelosSelecionados = Array.from(document.querySelectorAll("#cadastrar .checkboxList input:checked"))
        .map(cb => cb.nextElementSibling.textContent);

      if (!nome || !corHex) {
        showAlert("erro", "Preencha o nome e a cor!");
        return;
      }

      if (!valor) {
        showAlert("aviso", "Preencha o Valor!")
        return
      }

      if (modelosSelecionados.length === 0) {
        showAlert("aviso", "Selecione pelo menos um modelo!");
        return;
      }

      const res = await fetch(API_URL);
      const cores = await res.json();
      const novoId = cores.length > 0
        ? Math.max(...cores.map(c => Number(c.id) || 0)) + 1
        : 1;

      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          id: novoId,
          nome,
          cor: corHex,
          valor: valor || "0.00",
          modelos: modelosSelecionados
        })
      });

      showAlert("sucesso", "Cor cadastrada com sucesso!");

      document.getElementById("nomeCor").value = "";
      document.getElementById("colorPicker").value = "#F29DC3";
      document.getElementById("valorCor").value = "";
      document.querySelectorAll("#cadastrar .checkboxList input").forEach(cb => cb.checked = false);
      document.getElementById('cadastrar').style.display = 'none';
      listarCores();
    }

    function abrirEditar(id) {
      fetch(`${API_URL}/${id}`)
        .then(res => {
          if (!res.ok) throw new Error("Cor não encontrada");
          return res.json();
        })
        .then(cor => {
          document.getElementById('editar').style.display = 'flex';
          const modal = document.querySelector("#editar .modal-content");
          modal.querySelector("input[type='text']").value = cor.nome;
          modal.querySelector("#valorLaco").value = cor.valor;
          document.querySelectorAll("#editar .checkboxList input").forEach(cb => {
            cb.checked = cor.modelos && cor.modelos.includes(cb.nextElementSibling.textContent);
          });
        })
        .catch(() => {
          showAlert("erro", "Cor não encontrada!");
          fechar();
        });
      window.corEditandoId = id;
    }

    async function AtualizarCor() {
      const nome = document.querySelector("#editar input[type='text']").value.trim();
      const valor = document.getElementById("valorLaco").value.trim();
      const modelosSelecionados = Array.from(document.querySelectorAll("#editar .checkboxList input:checked"))
        .map(cb => cb.nextElementSibling.textContent);

      if (modelosSelecionados.length === 0) {
        showAlert("aviso", "Selecione pelo menos um modelo!");
        return;
      }

      let corHex = "#ffffff";
      try {
        const res = await fetch(`${API_URL}/${window.corEditandoId}`);
        if (res.ok) {
          const corObj = await res.json();
          corHex = corObj.cor || corHex;
        }
      } catch { }

      await fetch(`${API_URL}/${window.corEditandoId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          id: window.corEditandoId,
          nome,
          cor: corHex,
          valor,
          modelos: modelosSelecionados
        })
      });

      showAlert("sucesso", "Cor atualizada com sucesso!");
      document.getElementById('editar').style.display = 'none';
      listarCores();
    }

    function abrirExcluir(id, nome) {
      document.getElementById('excluir').style.display = 'flex';
      document.querySelector("#excluir .tituloPopUp").textContent = `Você Deseja Deletar: “${nome}”?`;
      window.corExcluindoId = id;
    }

    async function ExcluirCor() {
      try {
        const res = await fetch(`${API_URL}/${window.corExcluindoId}`, { method: "DELETE" });
        if (!res.ok) throw new Error("Erro ao excluir");
        showAlert("sucesso", "Cor excluída com sucesso!");
      } catch {
        showAlert("erro", "Cor não encontrada ou já excluída!");
      }
      document.getElementById('excluir').style.display = 'none';
      listarCores();
    }

    function fechar() {
      document.getElementById('cadastrar').style.display = 'none';
      document.getElementById('editar').style.display = 'none';
      document.getElementById('excluir').style.display = 'none';
    }

    window.onload = listarCores;
  </script>

</body>

</html>