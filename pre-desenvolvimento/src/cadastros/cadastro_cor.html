<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="./assets/iconeWeb.ico">
  <title>Preciosos Laços | Cadastro de Cores</title>

  <link rel="stylesheet" href="./css/cadastro_cor.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&display=swap" rel="stylesheet">

</head>

<body>
  <button class="toggle-btn" id="toggleSidebar"><i class="bi bi-list"></i></button>

  <div class="sidebar" id="sidebar">
    <img src="./assets/logo_preciosos_lacos.png" alt="Logo">
    <ul>
      <li><a href="#"><i class="bi bi-box"></i> <span>Pedidos</span></a></li>
      <li><a href="#"><i class="bi bi-card-list"></i> <span>Cadastro</span></a></li>
      <li><a href="#"><i class="bi bi-tag"></i> <span>Modelos</span></a></li>
      <li><a href="./cadastro_cor.html"><i class="bi bi-palette"></i> <span>Cores</span></a></li>
      <li><a href="#"><i class="bi bi-archive"></i> <span>Coleções</span></a></li>
      <li><a href="#"><i class="bi bi-scissors"></i> <span>Tipos de Laço</span></a></li>
      <li><a href="#"><i class="bi bi-bar-chart"></i> <span>Dashboard</span></a></li>
    </ul>
    <ul>
      <li><a href="#"><i class="bi bi-box-arrow-right"></i> <span>Sair</span></a></li>
    </ul>
  </div>

  <header>Preciosos Laços</header>

  <div class="nav-pesquisa">
    <div class="nav-search-wrapper">
      <input type="text" class="nav-search-box" placeholder="Pesquisar Cor" aria-label="Pesquisar Cor">
      <i class="bi bi-search" id="lupa-search"></i>
    </div>
    <a class="btn-cadastrar" onclick="document.getElementById('cadastrar').style.display='flex'"><i
        class="bi bi-patch-plus"></i><span> Cadastrar Cores</span></a>
  </div>


  <div class="content">


    <!-- <div class="card-container">
      <div class="card-custom">
        <h5>Vermelho</h5>
        <div class="color-box" style="background:#f44336"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Rosa</h5>
        <div class="color-box" style="background:#f8b2cc"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Lilas</h5>
        <div class="color-box" style="background: #dda0dd"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Azul claro</h5>
        <div class="color-box" style="background: lightskyblue"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Lavanda</h5>
        <div class="color-box" style="background: #cac1fe;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Amarelo</h5>
        <div class="color-box" style="background: #fdfd96;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Verde</h5>
        <div class="color-box" style="background: #98fb98;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Marrom</h5>
        <div class="color-box" style="background: #d2b48c;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Preto</h5>
        <div class="color-box" style="background: #000000;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div>

      <div class="card-custom">
        <h5>Branco</h5>
        <div class="color-box" style="background: #ffffff;"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>
            <li>Laço Padrão</li>
            <li>Laço de Festa</li>
            <li>Laço Infantil</li>
            <li>Laço Princesa</li>
            <li>Laço Piscina</li>
            <li>Laço Silicone</li>
          </ul>
        </div>
        <p class="mt-2">Valor: R$ 6,00</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="document.getElementById('editar').style.display='flex'"></i>
          <i class="bi bi-trash" onclick="document.getElementById('excluir').style.display='flex'"></i>
        </div>
      </div> -->

  </div>
  </div>

  <div id="cadastrar" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fechar()">&times;</span>
      <h2 class="tituloPopUp">Cadastro de Cor</h2>

      <input type="text" id="nomeCor" placeholder="Nome da cor: Verde-Água"
        style="width: 100%; padding: 8px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc;">

      <h3 class="titulo">Clique para escolher a cor:</h3>
      <input type="color" id="colorPicker" value="#F29DC3">
      <div class="color-block" id="colorBlock"></div>

      <input type="text" id="valorCor" placeholder="Valor: R$ 0,00"
        style="width: 100%; padding: 8px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc;">

      <h3 class="titulo">
        Associar modelo:
        <i class="bi bi-bookmark-plus-fill" style="color: #000000; margin-left: 5px;"></i>
      </h3>

      <div class="modal-search-wrapper">
        <input type="text" class="searchInput" id="searchModelo" class="search-box" placeholder="Pesquisar modelo">
        <i class="bi bi-search"></i>
      </div>

      <div class="checkboxList">
        <div><input type="checkbox" id="modelo1" value="1"><label for="modelo1">Laço Padrão</label></div>
        <div><input type="checkbox" id="modelo2" value="2"><label for="modelo2">Laço de Piscina</label></div>
        <div><input type="checkbox" id="modelo3" value="3"><label for="modelo3">Laço de Festa</label></div>
        <div><input type="checkbox" id="modelo4" value="4"><label for="modelo4">Laço Infantil</label></div>
        <div><input type="checkbox" id="modelo5" value="5"><label for="modelo5">Laço Escolar</label></div>
        <div><input type="checkbox" id="modelo6" value="6"><label for="modelo6">Laço de Gala</label></div>
        <div><input type="checkbox" id="modelo7" value="7"><label for="modelo7">Laço Esportivo</label></div>
        <div><input type="checkbox" id="modelo8" value="8"><label for="modelo8">Laço Casual</label></div>
      </div>

      <button id="fecharModal" onclick="cadastrarCor()">Cadastrar cor</button>
    </div>
  </div>

  <div id="editar" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fechar()">&times;</span>
      <h2 class="tituloPopUp">Editar Cor</h2>

      <input type="text" style="width: 100%; padding: 8px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc;"
        readonly>

      <h3 class="titulo">Valor</h3>

      <h3 class="titulo">
        Modelos Associados:
        <i class="bi bi-bookmark-plus-fill" style="color: #000000; margin-left: 5px;"></i>
      </h3>

      <div class="modal-search-wrapper">
        <input type="text" class="searchInput" id="searchModeloEditar" class="modal-search-box"
          placeholder="Pesquisar modelo">
        <i class="bi bi-search"></i>
      </div>

      <div class="checkboxList">
        <div><input type="checkbox" id="modelo1" checked><label for="modelo1">Laço Padrão</label></div>
        <div><input type="checkbox" id="modelo2"><label for="modelo2">Laço de Piscina</label></div>
        <div><input type="checkbox" id="modelo3"><label for="modelo3">Laço de Festa</label></div>
        <div><input type="checkbox" id="modelo4" checked><label for="modelo4">Laço Infantil</label></div>
        <div><input type="checkbox" id="modelo5"><label for="modelo5">Laço Escolar</label></div>
        <div><input type="checkbox" id="modelo6" checked><label for="modelo6">Laço de Gala</label></div>
        <div><input type="checkbox" id="modelo7"><label for="modelo7">Laço Esportivo</label></div>
        <div><input type="checkbox" id="modelo8"><label for="modelo8">Laço Casual</label></div>
      </div>

      <button id="fecharModal" onclick="AtualizarCor()">Atualizar cor</button>
    </div>
  </div>

  <div id="excluir" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fechar()">&times;</span>
      <h2 class="tituloPopUp">Você Deseja Deletar: “Vermelho”?</h2>

      <button id="fecharModalExcluir" onclick="ExcluirCor()">Deletar cor</button>
      <button id="fecharModalCancelar" onclick="fechar()">Cancelar</button>
    </div>
  </div>

</body>

</html>

<script>
  const API_URL = "http://localhost:3000/cores";

  const toggleBtn = document.getElementById("toggleSidebar");
  const sidebar = document.getElementById("sidebar");

  toggleBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    sidebar.classList.toggle("active");
  });

  const items = sidebar.querySelectorAll("li");
  items.forEach(item => {
    item.addEventListener("click", () => {
      if (window.innerWidth <= 992) {
        sidebar.classList.remove("active");
      }
    });
  });

  document.addEventListener("click", (e) => {
    if (window.innerWidth <= 992) {
      if (sidebar.classList.contains("active") && !sidebar.contains(e.target) && e.target !== toggleBtn) {
        sidebar.classList.remove("active");
      }
    }
  });

  let cor = [];

  async function listarCores() {
    const res = await fetch(API_URL);
    const cores = await res.json();

    const container = document.querySelector(".card-container");
    container.innerHTML = "";

    cores.forEach(cor => {
      const card = document.createElement("div");
      card.classList.add("card-custom");

      // usa array seguro para evitar erro no .map()
      const modelos = Array.isArray(cor.modelos) ? cor.modelos : [];

      card.innerHTML = `
        <h5>${cor.nome}</h5>
        <div class="color-box" style="background:${cor.hex}"></div>
        <p><strong>Modelos Associados:</strong></p>
        <div class="list-associates">
          <ul>${modelos.map(m => `<li>${m}</li>`).join("")}</ul>
        </div>
        <p class="mt-2">Valor: R$ ${Number(cor.valor).toFixed(2)}</p>
        <div class="icons">
          <i class="bi bi-pencil" onclick="abrirEditar(${JSON.stringify(cor.id)})"></i>
          <i class="bi bi-trash" onclick="abrirExcluir(${JSON.stringify(cor.id)}, '${cor.nome}')"></i>
        </div>
      `;
      container.appendChild(card);
    });
  }


  async function cadastrarCor(nome, hex, valor, modelos) {
    try {
      const res = await fetch(API_URL);
      const cores = await res.json();

      let maxId = 0;
      cores.forEach(c => {
        const idNum = parseInt(c.id, 10);
        if (!isNaN(idNum) && idNum > maxId) {
          maxId = idNum;
        }
      });

      const novaCor = {
        id: maxId + 1,
        nome,
        hex,
        valor,
        modelos: modelos || [] // garante array
      };

      const response = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(novaCor)
      });

      if (!response.ok) throw new Error("Erro ao cadastrar cor");

      alert("Cor cadastrada com sucesso!");
      listarCores();
    } catch (error) {
      console.error("Erro no cadastro:", error);
      alert("Erro ao cadastrar cor!");
    }
  }

  function cadastroConfirmado() {
    alert("Cadastro de cor realizado com sucesso!");

    const colorPicker = document.getElementById("colorPicker");
    if (colorPicker) colorPicker.value = "#F29DC3";

    const colorBlock = document.getElementById("colorBlock");
    if (colorBlock) {
      colorBlock.style.background = "linear-gradient(to right, red, orange, yellow, green, cyan, blue, violet)";
      colorBlock.textContent = "";
      colorBlock.style.color = "#000";
    }

    document.querySelectorAll(".checkboxList input").forEach(chk => chk.checked = false);
  }

  async function alterar() {
    const id = document.getElementById("id").value;
    const nome = document.getElementById("nome").value;
    if (!id) return alert("Selecione alguém da lista para editar!");

    await fetch(`${API_URL}/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ id: Number(id), nome })
    });
    mostrar();
  }

  async function remover() {
    const id = document.getElementById("id").value;
    if (!id) return alert("Selecione alguém da lista para excluir!");

    await fetch(`${API_URL}/${id}`, { method: "DELETE" });
    mostrar();
    document.getElementById("id").value = "";
    document.getElementById("nome").value = "";
  }

  function selecionar(id) {
    const pessoa = cor.find(p => p.id === id);
    document.getElementById("id").value = pessoa.id;
    document.getElementById("nome").value = pessoa.nome;
  }

  function fechar() {
    document.querySelectorAll(".modal").forEach(m => m.style.display = "none");
  }

  function validarMostrar() {
    if (cor.length > 0) {
      mostrar();
    } else {
      alert("Nenhuma cor cadastrada!");
    }
  }

  window.onload = validarMostrar();

</script>